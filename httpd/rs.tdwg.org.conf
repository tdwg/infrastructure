<VirtualHost *:80>
  ServerName rs.tdwg.org
  DocumentRoot /var/www/html/rs.tdwg.org/

  ErrorLog logs/rs-80_error
  CustomLog logs/rs-80_log combined
  LogLevel warn

  DirectoryIndex index.html index.htm rddl.html

  # Rewrite engine setup
  RewriteEngine On

### DAV ###
  # shutdown dav server
  RewriteRule ^/dav/subgroups/tapir/1.0/docs/(.+)$ https://tdwg.github.io/tapir/doc/$1 [NE,L,R]


### TAPIR ###
  # output models and concepts are living documents
  RewriteRule ^/tapir/cns/(.*)$ https://tdwg.github.io/tapir/cns/$1 [NE,L,R]
  RewriteRule ^/tapir/cs/(.*)$ https://tdwg.github.io/tapir/cs/$1 [NE,L,R]
  # released docs, version 1.0
  RewriteRule ^/tapir/1.0/schema/tdwg_tapir.xsd$ https://raw.githubusercontent.com/tdwg/tapir/1.0/schema/tapir.xsd [NE,L,P]
  RewriteRule ^/tapir/1.0/(.+)$ https://raw.githubusercontent.com/tdwg/tapir/1.0/$1 [NE,L,P]


### ONTOLOGY ###
  ProxyPass /ontology2 http://tdwg-ontology.googlecode.com/svn/trunk/ontology/
  # proxy from github
  ProxyPass /ontology http://tdwg.github.io/ontology/ontology/



### DWC ###

  # Content Negotiation defaults to HTML if RDF/XML is not requested
  
  # Remove all index.htm / index.html
  RewriteRule ^/dwc/(.*)index.html? /dwc/$1 [NE,R,L]

  # DWC attributes
  RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
  RewriteRule ^/dwc/terms/attributes/(.*)$ https://dwc.tdwg.org/terms/attributes/dwcattributes.rdf [R=303]
  RewriteRule ^/dwc/terms/attributes/(.*)$ https://dwc.tdwg.org/terms/attributes/dwcattributes.rdf#$1 [NE,R=303] #NE,R,L,P]

  # DWC terms
  RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
  RewriteRule ^/dwc/terms/([a-zA-Z0-9-]*)$ https://dwc.tdwg.org/rdf/dwcterms.rdf [R=303]
  RewriteRule ^/dwc/terms/([a-zA-Z0-9-]+)$ https://dwc.tdwg.org/terms/#$1 [NE,R=303]

  #^/dwc/dwcore/version/Family-2007-04-17 | Handled by @baskaufs script?
  RewriteRule ^/dwc/terms/namespace/ https://dwc.tdwg.org/namespace/ [R=303,L]
  RewriteRule ^/dwc/terms/simple/ https://dwc.tdwg.org/simple/ [R=303,L]
  RewriteRule ^/dwc/terms/guides/text/ https://dwc.tdwg.org/text/ [R=303,L]
  RewriteRule ^/dwc/terms/guides/xml/ https://dwc.tdwg.org/xml/ [R=303,L]
  RewriteRule ^/dwc/terms/guides/rdf/ https://dwc.tdwg.org/rdf/ [R=303,L]
  RewriteRule ^/dwc/terms/history/$ https://github.com/tdwg/dwc/blob/master/vocabulary/term_versions.csv [R=303,L]
  RewriteRule ^/dwc/terms/history/decisions/ https://dwc.tdwg.org/decisions/ [R=303,L]
  RewriteRule ^/dwc/terms/history/dwctoabcd/ https://github.com/tdwg/dwc/blob/master/vocabulary/term_versions.csv [R=303,L]
  RewriteRule ^/dwc/terms/history/versions/ https://github.com/tdwg/dwc/blob/master/vocabulary/term_versions.csv [R=303,L]

  # proxy all other /dwc URLs from github pages:
  RewriteRule ^/dwc$ /dwc/ [R,L]
  RewriteRule ^/dwc/$     https://dwc.tdwg.org/ [NE,L,P]
  RewriteRule ^/dwc/(.+)/$ https://dwc.tdwg.org/$1/ [NE,L,P]
  RewriteRule ^/dwc/(.+)$  https://dwc.tdwg.org/$1 [NE,L,P]

  SSLProxyEngine On

  <Location /dwc>
    # Directive to ensure *.rdf files served as appropriate content type,
    # if not present in main apache config
    AddType application/rdf+xml .rdf
    AddType text/xml .xml
    AddType text/xml .xsd
    AddType text/html .html
    AddType text/html .htm
    AddType text/plain .txt
 </Location>



### AudubonCore ###
  # Resolution of ac term URIs
  RewriteRule ^/ac/terms/([^/]+)$ http://terms.tdwg.org/wiki/Audubon_Core_Term_List#ac:$1 [NE,R=303,L]
  # proxy from github ???
  ProxyPass /ac http://tdwg.github.io/ac/

  <Location /ac>
    # Directive to ensure *.rdf files served as appropriate content type,
    # if not present in main apache config
    AddType application/rdf+xml .rdf
    AddType text/xml .xml
    AddType text/xml .xsd
    AddType text/html .html
    AddType text/html .htm
    AddType text/plain .txt
 </Location>


 ### SDD ###
   # proxy from github
   ProxyPass /sdd http://tdwg.github.io/sdd/
   ProxyPass /UBIF http://tdwg.github.io/sdd/

 ### ABCD ###
   #ABCD 2 terms
   RewriteRule ^/abcd2/terms/([a-zA-Z0-9-._@]+)$ https://terms.tdwg.org/wiki/abcd2:$1 [NE,R=303]
   RewriteRule ^/abcd2(/(terms(/)?)?)?$ https://terms.tdwg.org/wiki/ABCD_2 [NE,R=303]
   #ABCD EFG terms
   RewriteRule ^/abcd-efg/terms/([a-zA-Z0-9-._@]+)$ https://terms.tdwg.org/wiki/abcd-efg:$1 [NE,R=303]
   RewriteRule ^/abcd-efg(/(terms(/)?)?)?$ https://terms.tdwg.org/wiki/ABCD_EFG [NE,R=303]
   
   #ABCD 3.0 terms   
      #content negotiations for concepts ontology (ABCD Core Ontology)
   RewriteCond %{HTTP_ACCEPT} ^.*application/rdf\+xml.* 
   RewriteRule ^/abcd/terms/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/ontology/abcd_concepts.owl [R=303,L]
   RewriteCond %{HTTP_ACCEPT} ^.*text/turtle.* 
   RewriteRule ^/abcd/terms/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/ontology/abcd_concepts.ttl [R=303,L]
   RewriteCond %{HTTP_ACCEPT} ^.*application/ld\+json.* 
   RewriteRule ^/abcd/terms/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/ontology/abcd_concepts.jsonld [R=303,L]
   
      #content negotiations for mappings ontology
   RewriteCond %{HTTP_ACCEPT} ^.*application/rdf\+xml.* 
   RewriteRule ^/abcd/mappings/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/ontology/abcd_mappings.owl [R=303,L]
   RewriteCond %{HTTP_ACCEPT} ^.*text/turtle.* 
   RewriteRule ^/abcd/mappings/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/ontology/abcd_mappings.ttl [R=303,L]
   RewriteCond %{HTTP_ACCEPT} ^.*application/ld\+json.* 
   RewriteRule ^/abcd/mappings/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/ontology/abcd_mappings.jsonld [R=303,L]
   
     #redirects for human readable pages
   RewriteRule ^/abcd/terms/history/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/terms/history/#$1 [NE,R=303]
   RewriteRule ^/abcd/terms/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/terms/#$1 [NE,R=303]
   RewriteRule ^/abcd/terms/?$ https://abcd.tdwg.org/terms/ [NE,R=303]
   RewriteRule ^/abcd/mapping/([a-zA-Z0-9-._@]+)$ https://abcd.tdwg.org/terms/mappings/#$1 [NE,R=303]
   RewriteRule ^/abcd/mapping/?$ https://abcd.tdwg.org/terms/mappings/ [NE,R=303]
   RewriteRule ^/abcd/?$ https://abcd.tdwg.org/ [NE,R=303]
   
   #legacy paths (old schema locations should remain valid)
   RewriteRule ^/abcd/((1\.2|2\.06|ABCD_).*)$ https://abcd.tdwg.org/legacy/$1 [NE,R=301]

</VirtualHost>
